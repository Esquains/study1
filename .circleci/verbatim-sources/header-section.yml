# WARNING: DO NOT EDIT THIS FILE DIRECTLY!!!
# See the README.md in this directory.

# IMPORTANT: To update Docker image version, please first update:
#
#   https://github.com/pytorch/ossci-job-dsl/blob/master/src/main/groovy/ossci/pytorch/DockerVersion.groovy and
#   https://github.com/pytorch/ossci-job-dsl/blob/master/src/main/groovy/ossci/caffe2/DockerVersion.groovy,
#
# and then grep the old docker version to find additional changes needed. For example, if you are changing the
# docker version from a8006f9a-272d-4478-b137-d121c6f05c83 to 07597f23-fa81-474c-8bef-5c8a91b50595, you should:
#
#   cd .circleci
#   grep a8006f9a-272d-4478-b137-d121c6f05c83 -r . --exclude=config.yml
#
# and then change all the files found by the above command. Be careful about the workflows-ecr-gc.yml, instead of
# replacing the old docker version, you should append your new docker version to the `tags_to_keep`.
#
# See also: https://github.com/pytorch/pytorch/wiki/Docker-image-build-on-CircleCI#how-to-use-new-images

version: 2.1

docker_config_defaults: &docker_config_defaults
  user: jenkins
  aws_auth:
    # This IAM user only allows read-write access to ECR
    aws_access_key_id: ${CIRCLECI_AWS_ACCESS_KEY_FOR_ECR_READ_WRITE_V4}
    aws_secret_access_key: ${CIRCLECI_AWS_SECRET_KEY_FOR_ECR_READ_WRITE_V4}

executors:
  windows-with-nvidia-gpu:
    machine:
      resource_class: windows.gpu.nvidia.medium
      image: windows-server-2019-nvidia:stable
      shell: bash.exe

  windows-cpu-with-nvidia-cuda:
    machine:
      # we will change to CPU host when it's ready
      resource_class: windows.xlarge
      image: windows-server-2019-vs2019:stable
      shell: bash.exe
